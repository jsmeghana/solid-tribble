package org.meghana.creditcardapi.transactions.dao;

import javax.sql.DataSource;

import org.meghana.creditcardapi.transactions.model.Account;
import org.meghana.creditcardapi.transactions.model.AccountDAO;
import org.meghana.creditcardapi.transactions.model.Transaction;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;

public class AccountDaoImpl implements AccountDAO{
	@Autowired
	private DataSource dataSource;
	private JdbcTemplate jdbcTemplateObject;
	
	public void setDataSource(DataSource ds) {
		this.dataSource = dataSource;
	    this.jdbcTemplateObject = new JdbcTemplate(dataSource);
	}

	public DataSource getDataSource() {
		return dataSource;
	}

	@Override
	//public void create(String name, String dob){
	public String create(Account ac){
		
		 String SQL = "insert into account1 (name, dob, ssn, id) values (?, ?,?,?)";
		 String dob = ac.getDob().replace("/", "");
		 String Id=Integer.toString(ac.getSsn())+dob;
		 System.out.println(Id);
	     jdbcTemplateObject.update( SQL, ac.getName(), ac.getDob(),ac.getSsn(),Id);
	     System.out.println("Created Account Name = " + ac.getName() + " DOB = " + ac.getDob());
	     Transaction t = new Transaction(Id, "Account Creation", 200d);
	     this.ImplementTransaction(t);
	     return Id;
	}
	
	public void ImplementTransaction(Transaction t){
		
		String SQL = "insert into transaction1 (transcationid, transactiontype, timestamp, ammount, accountid) values (?,?,?,?,?)";
		
		
		
	
		
	}

	@Override
	public Account getAccountdetails(String id) {
		String SQL = "select * from account1 where id = ?";
	      Account account = jdbcTemplateObject.queryForObject(SQL, 
	         new Object[]{id}, new AccountMapper());
		return account;
	}

	@Override
	public Transaction getTransaction(Account id) {
		// TODO Auto-generated method stub
		return null;
	}

	
	}
	
	
	


